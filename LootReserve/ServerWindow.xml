<Ui xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns="http://www.blizzard.com/wow/ui/">
	<Script file="ServerWindow.lua" />
	<Button name="LootReserveServerWindowTabTemplate" parentArray="Tabs" virtual="true">
		<Size>
			<AbsDimension x="10" y="32" />
		</Size>
		<Layers>
			<Layer level="BACKGROUND">
				<Texture parentKey="LeftDisabled" file="Interface\PaperDollInfoFrame\UI-Character-ActiveTab">
					<Size x="20" y="32" />
					<Anchors>
						<Anchor point="TOPLEFT" x="0" y="5" />
					</Anchors>
					<TexCoords left="0" right="0.15625" top="0" bottom="1" />
				</Texture>
				<Texture parentKey="MiddleDisabled" file="Interface\PaperDollInfoFrame\UI-Character-ActiveTab">
					<Size x="88" y="32" />
					<Anchors>
						<Anchor point="LEFT" relativeKey="$parent.LeftDisabled" relativePoint="RIGHT" />
					</Anchors>
					<TexCoords left="0.15625" right="0.84375" top="0" bottom="1" />
				</Texture>
				<Texture parentKey="RightDisabled" file="Interface\PaperDollInfoFrame\UI-Character-ActiveTab">
					<Size x="20" y="32" />
					<Anchors>
						<Anchor point="LEFT" relativeKey="$parent.MiddleDisabled" relativePoint="RIGHT" />
					</Anchors>
					<TexCoords left="0.84375" right="1" top="0" bottom="1" />
				</Texture>
				<Texture parentKey="Left" file="Interface\PaperDollInfoFrame\UI-Character-InActiveTab">
					<Size x="20" y="32" />
					<Anchors>
						<Anchor point="TOPLEFT" x="0" y="1" />
					</Anchors>
					<TexCoords left="0" right="0.15625" top="0" bottom="1" />
				</Texture>
				<Texture parentKey="Middle" file="Interface\PaperDollInfoFrame\UI-Character-InActiveTab">
					<Size x="88" y="32" />
					<Anchors>
						<Anchor point="LEFT" relativeKey="$parent.Left" relativePoint="RIGHT" />
					</Anchors>
					<TexCoords left="0.15625" right="0.84375" top="0" bottom="1" />
				</Texture>
				<Texture parentKey="Right" file="Interface\PaperDollInfoFrame\UI-Character-InActiveTab">
					<Size x="20" y="32" />
					<Anchors>
						<Anchor point="LEFT" relativeKey="$parent.Middle" relativePoint="RIGHT" />
					</Anchors>
					<TexCoords left="0.84375" right="1" top="0" bottom="1" />
				</Texture>
			</Layer>
		</Layers>
		<Scripts>
			<OnLoad>
				self.selectedTextY = 4;
				self:SetFrameLevel(self:GetFrameLevel() + 4);
				self:RegisterEvent("DISPLAY_SIZE_CHANGED");
			</OnLoad>
			<OnEvent>
				if (self:IsVisible()) then
					PanelTemplates_TabResize(self, 0, nil, 36, self:GetParent().maxTabWidth or 88);
				end
			</OnEvent>
			<OnShow>
				PanelTemplates_TabResize(self, 0);
			</OnShow>
			<OnClick>
				LootReserve.Server:OnWindowTabClick(self);
			</OnClick>
		</Scripts>
		<HighlightTexture parentKey="HighlightTexture" file="Interface\PaperDollInfoFrame\UI-Character-Tab-RealHighlight" alphaMode="ADD">
			<Anchors>
				<Anchor point="TOPLEFT">
					<Offset>
						<AbsDimension x="3" y="5"/>
					</Offset>
				</Anchor>
				<Anchor point="BOTTOMRIGHT">
					<Offset>
						<AbsDimension x="-3" y="0"/>
					</Offset>
				</Anchor>
			</Anchors>
		</HighlightTexture>
		<ButtonText parentKey="Text">
			<Size x="0" y="10" />
			<Anchors>
				<Anchor point="CENTER" x="0" y="2" />
			</Anchors>
		</ButtonText>
		<NormalFont style="GameFontNormalSmall" />
		<HighlightFont style="GameFontHighlightSmall" />
		<DisabledFont style="GameFontHighlightSmall" />
	</Button>
	<Button name="LootReserveReserveListPlayerTemplate" virtual="true">
		<Size y="16" />
		<Layers>
			<Layer>
				<Texture parentKey="WinnerHighlight" file="Interface\QUESTFRAME\UI-QuestTitleHighlight" alphaMode="ADD" alpha="0.5">
					<Anchors>
						<Anchor point="TOPLEFT" x="16" />
						<Anchor point="BOTTOMRIGHT" />
					</Anchors>
					<Color r="0" g="1" b="0" />
				</Texture>
			</Layer>
			<Layer level="OVERLAY">
				<FontString parentKey="Name" inherits="GameFontWhiteSmall" justifyH="LEFT">
					<Anchors>
						<Anchor point="TOPLEFT" x="16" />
						<Anchor point="BOTTOMRIGHT" x="-32" />
					</Anchors>
				</FontString>
				<FontString parentKey="Roll" inherits="GameFontWhiteSmall" justifyH="CENTER">
					<Anchors>
						<Anchor point="TOPLEFT" relativeKey="$parent.Name" relativePoint="TOPRIGHT" />
						<Anchor point="BOTTOMRIGHT" />
					</Anchors>
				</FontString>
			</Layer>
		</Layers>
		<Frames>
			<Button parentKey="ButtonDelete" hidden="true">
				<Size x="12" y="12"/>
				<Anchors>
					<Anchor point="TOPLEFT" x="2" y="-2" />
				</Anchors>
				<Scripts>
					<OnClick>
						local player = self:GetParent().Player;
						local frame = self:GetParent():GetParent():GetParent();
						local data = { Player = player, Item = frame.Item };
						StaticPopup_Show("LOOTRESERVE_CONFIRM_FORCED_CANCEL_RESERVE", LootReserve:ColoredPlayer(player), frame.Link, data);
					</OnClick>
				</Scripts>
				<NormalTexture file="Interface\Buttons\UI-GroupLoot-Pass-Up" alpha="0.5"/>
				<HighlightTexture file="Interface\Buttons\UI-GroupLoot-Pass-Up" alpha="0.5" alphaMode="ADD"/>
				<PushedTexture file="Interface\Buttons\UI-GroupLoot-Pass-Down" alpha="0.5"/>
			</Button>
			<Frame parentKey="DropDown" inherits="UIDropDownMenuTemplate" hidden="true" />
		</Frames>
		<Scripts>
			<OnUpdate>
				self.ButtonDelete:SetShown(self:IsMouseOver());
			</OnUpdate>
		</Scripts>
	</Button>
	<Button name="LootReserveReserveListPlayerSecureTemplate" inherits="LootReserveReserveListPlayerTemplate, SecureUnitButtonTemplate" virtual="true">
		<Layers>
			<Layer level="HIGHLIGHT">
				<Texture file="Interface\QUESTFRAME\UI-QuestTitleHighlight" alphaMode="ADD" alpha="0.25">
					<Anchors>
						<Anchor point="TOPLEFT" x="16" />
						<Anchor point="BOTTOMRIGHT" />
					</Anchors>
					<Color r="1" g="1" b="1" />
				</Texture>
			</Layer>
		</Layers>
		<Scripts>
			<OnLoad>
				self:RegisterForClicks("LeftButtonUp", "RightButtonUp");
				SecureUnitButton_OnLoad(self, nil, function()
					local button = self;
					UIDropDownMenu_Initialize(self.DropDown, function(self)
						local dropdown = UIDROPDOWNMENU_OPEN_MENU or self;
						local unit = button:GetAttribute("unit");
						if unit then
							UnitPopup_ShowMenu(dropdown, "PLAYER", unit);
						end
					end, "MENU");
					ToggleDropDownMenu(nil, nil, self.DropDown, "cursor", 0, 0);
				end);
			</OnLoad>
			<OnUpdate>
				if InCombatLockdown() then return; end
				self.ButtonDelete:SetShown(self:IsMouseOver());
			</OnUpdate>
		</Scripts>
	</Button>
	<Frame name="LootReserveReserveListTemplate" virtual="true" enableMouse="true">
		<Size y="200" />
		<Backdrop bgFile="Interface\DialogFrame\UI-DialogBox-Background" edgeFile="Interface\Tooltips\UI-Tooltip-Border">
			<BackgroundInsets left="5" right="5" top="5" bottom="5" />
			<EdgeSize val="16" />
			<BorderColor r="1" g="1" b="1" a="1" />
		</Backdrop>
		<Frames>
			<Button parentKey="RequestRollButton">
				<Size x="32" y="32" />
				<Anchors>
					<Anchor point="TOPRIGHT" x="-6" y="-6" />
				</Anchors>
				<Layers>
					<Layer level="OVERLAY">
						<Texture parentKey="CancelIcon" file="Interface\Buttons\UI-GroupLoot-Pass-Up">
							<Size x="16" y="16" />
							<Anchors>
								<Anchor point="BOTTOMRIGHT" />
							</Anchors>
						</Texture>
					</Layer>
				</Layers>
				<Scripts>
					<OnLoad>
						self.UpdateTooltip = function(self)
							local rollingThisItem = LootReserve.Server:IsRolling(self:GetParent().Item);
							GameTooltip:SetOwner(self, "ANCHOR_RIGHT");
							GameTooltip:SetText(rollingThisItem and "End Roll" or "Request Roll");
							GameTooltip:AddLine(rollingThisItem and "Stop accepting rolls for this item." or "Ask all players who reserved this item to /roll on it.", HIGHLIGHT_FONT_COLOR.r, HIGHLIGHT_FONT_COLOR.g, HIGHLIGHT_FONT_COLOR.b, 1, 1);
							GameTooltip:Show();
						end
					</OnLoad>
					<OnClick>
						if LootReserve.Server:IsRolling(self:GetParent().Item) then
							LootReserve.Server:CancelRollRequest(self:GetParent().Item);
						else
							LootReserve.Server:RequestRoll(self:GetParent().Item);
						end

						if GameTooltip:IsOwned(self) then
							self:UpdateTooltip();
						end
					</OnClick>
					<OnEnter>
						self:UpdateTooltip();
					</OnEnter>
					<OnLeave function="GameTooltip_Hide" />
				</Scripts>
				<NormalTexture file="Interface\Buttons\UI-GroupLoot-Dice-Up" />
				<HighlightTexture file="Interface\Buttons\UI-GroupLoot-Dice-Highlight" alphaMode="ADD" />
				<PushedTexture file="Interface\Buttons\UI-GroupLoot-Dice-Down" />
			</Button>
			<Button parentKey="ItemFrame" inherits="LootReserveItemButtomTemplate">
				<KeyValues>
					<KeyValue key="tooltipRight" value="true" type="boolean" />
				</KeyValues>
				<Anchors>
					<Anchor point="TOPLEFT" x="6" y="-6" />
					<Anchor point="TOPRIGHT" relativeKey="$parent.RequestRollButton" relativePoint="TOPLEFT" x="-5" />
				</Anchors>
			</Button>
			<Frame parentKey="ReservesFrame">
				<Anchors>
					<Anchor point="TOPLEFT" relativeKey="$parent.ItemFrame" relativePoint="BOTTOMLEFT" y="-5" />
					<Anchor point="BOTTOMRIGHT" x="-6" y="6" />
				</Anchors>
				<Layers>
					<Layer layer="OVERLAY">
						<FontString parentKey="HeaderRoll" inherits="GameFontNormalSmall" text="Roll" justifyH="CENTER">
							<Size x="32" y="12" />
							<Anchors>
								<Anchor point="TOPRIGHT" />
							</Anchors>
						</FontString>
						<FontString parentKey="HeaderPlayer" inherits="GameFontNormalSmall" text="Reserved by" justifyH="LEFT">
							<Size y="12" />
							<Anchors>
								<Anchor point="TOPLEFT" x="16" />
								<Anchor point="TOPRIGHT" relativeKey="$parent.HeaderRoll" relativePoint="TOPLEFT" />
							</Anchors>
						</FontString>
					</Layer>
					<Layer layer="ARTWORK">
						<Texture parentKey="HeaderGlow" alpha="0.25" file="Interface\CHATFRAME\ChatFrameTab-NewMessage" alphaMode="ADD">
							<Size y="12" />
							<Anchors>
								<Anchor point="BOTTOMLEFT" relativeKey="$parent.HeaderPlayer" x="-16" y="-2" />
								<Anchor point="BOTTOMRIGHT" relativeKey="$parent.HeaderRoll" y="-2" />
							</Anchors>
							<Color r="1" g="0.82" b="0" />
						</Texture>
						<Texture alpha=".5" file="Interface\CHATFRAME\ChatFrameTab-NewMessage" alphaMode="ADD">
							<Size y="3" />
							<Anchors>
								<Anchor point="BOTTOMLEFT" relativeKey="$parent.HeaderGlow" x="16" />
								<Anchor point="BOTTOMRIGHT" relativeKey="$parent.HeaderGlow" x="-16" />
							</Anchors>
							<Color r="1" g="1" b="1" />
						</Texture>
					</Layer>
				</Layers>
			</Frame>
		</Frames>
	</Frame>
	<Frame name="LootReserveServerWindow" inherits="BasicFrameTemplateWithInset" parent="UIParent" toplevel="true" movable="true" resizable="true" enableMouse="true" clampedToScreen="true" hidden="true">
		<Size x="230" y="360" />
		<Anchors>
			<Anchor point="CENTER" />
		</Anchors>
		<Frames>
			<Button inherits="LootReserveCommonFrameMovingHeaderTemplate" />
			<Button inherits="LootReserveCommonFrameSizeGrabberTemplate" />
			<Button parentKey="ButtonSettings" inherits="UIMenuButtonStretchTemplate" frameLevel="100">
				<Size x="20" y="20" />
				<Anchors>
					<Anchor point="TOPLEFT" y="-1" />
				</Anchors>
				<Layers>
					<Layer>
						<Texture parentKey="Icon" file="Interface\Buttons\UI-OptionsButton">
							<Size x="14" y="14" />
							<Anchors>
								<Anchor point="CENTER" />
							</Anchors>
						</Texture>
					</Layer>
				</Layers>
				<HighlightTexture file="Interface\Buttons\UI-Common-MouseHilight" alphaMode="ADD" />
				<Scripts>
					<OnLoad>
						self:SetPushedTextOffset(1, -1);
					</OnLoad>
					<OnClick>
						local root = LootReserve.Server.Settings;
						local function MakeMenuItem(text, setting, tooltip)
							return
							{
								text = text,
								arg1 = setting,
								func = function(info) root[setting] = not root[setting]; end,
								checked = function(info) return root[setting]; end,
								notCheckable = false,
								keepShownOnClick = true,
								tooltipTitle = tooltip and text or nil,
								tooltipText = tooltip,
								tooltipOnButton = true,
							};
						end
						local menu =
						{
							{ text = "Communications", isTitle = true },
							MakeMenuItem("Send Reserve Updates", "ChatUpdates", "Send whispers to players without addons if someone else reserves or cancels the reserve of the items that they have reserved as well."),
							MakeMenuItem("Slow Chat Messages", "ChatThrottle", "Slow down broadcasting of Raid and Whisper messages. Will lead to some messages being delivered late. Enable only if WoW servers are blocking your messages due to spam."),
							{ text = "", isTitle = true },
							{ text = "Close" },
						};
						for _, menu in ipairs({ menu, menuWhisperPlayers }) do
							for _, item in ipairs(menu) do
								if item.notCheckable == nil then
									item.notCheckable = true;
								end
							end
						end
						
						EasyMenu(menu, self:GetParent().Menu, self, 0, 0, "MENU");
					</OnClick>
					<OnMouseDown>
						self.Icon:SetPoint("CENTER", self, "CENTER", self:GetPushedTextOffset());
					</OnMouseDown>
					<OnMouseUp>
						self.Icon:SetPoint("CENTER", self, "CENTER");
					</OnMouseUp>
					<OnEnter>
						GameTooltip:SetOwner(self, "ANCHOR_RIGHT");
						GameTooltip:SetText("Settings");
					</OnEnter>
					<OnLeave function="GameTooltip_Hide" />
				</Scripts>
			</Button>
			<StatusBar parentKey="Duration" inherits="LootReserveDurationStatusBar">
				<KeyValues>
					<KeyValue key="server" value="true" type="boolean" />
				</KeyValues>
				<Size y="8" />
				<Anchors>
					<Anchor point="TOPLEFT" x="7" y="-27" />
					<Anchor point="TOPRIGHT" x="-10" y="-27" />
				</Anchors>
			</StatusBar>
			<EditBox parentKey="Search" inherits="SearchBoxTemplate">
				<Size y="20" />
				<Anchors>
					<Anchor point="TOPLEFT" x="10" y="-25" />
					<Anchor point="TOPRIGHT" x="-7" y="-25" />
				</Anchors>
				<Scripts>
					<OnLoad>
						SearchBoxTemplate_OnLoad(self);
						self.Instructions:SetText("Search items or players");
						self.Instructions:SetPoint("BOTTOMRIGHT", self, "BOTTOMRIGHT", -8, 0);
						self.Instructions:SetWordWrap(false);
					</OnLoad>
					<OnTextChanged>
						InputBoxInstructions_OnTextChanged(self);
						LootReserve.Server:UpdateReserveList();
					</OnTextChanged>
				</Scripts>
			</EditBox>
			<Button parentKey="ButtonMenu" inherits="UIMenuButtonStretchTemplate">
				<Size y="21" />
				<Anchors>
					<Anchor point="TOPLEFT" relativeKey="$parent.Search" relativePoint="TOPRIGHT" x="0" y="0" />
					<Anchor point="TOPRIGHT" relativeKey="$parent.Search" relativePoint="TOPRIGHT" x="80" y="0" />
				</Anchors>
				<Layers>
					<Layer>
						<Texture parentKey="Arrow" file="Interface\BUTTONS\UI-SortArrow">
							<Size x="8" y="8" />
							<Anchors>
								<Anchor point="RIGHT" x="-8" />
							</Anchors>
							<TexCoords left="0" right="0.5" top="0" bottom="1" />
						</Texture>
						<Texture parentKey="Icon" file="Interface\CHATFRAME\UI-ChatConversationIcon">
							<Size x="16" y="16" />
							<Anchors>
								<Anchor point="LEFT" x="6" />
							</Anchors>
						</Texture>
					</Layer>
				</Layers>
				<Scripts>
					<OnLoad>
						self:SetPushedTextOffset(1, -1);
						self:SetNormalFontObject(GameFontHighlightSmallLeft);
						self:SetHighlightFontObject(GameFontHighlightSmallLeft);
						self:SetDisabledFontObject(GameFontDisableSmallLeft);
						self.Text:ClearAllPoints();
						self.Text:SetPoint("LEFT", self, "LEFT", 8 + 16, 0);
						self.Text:SetPoint("RIGHT", self, "RIGHT", -8 - 8, 0);
						self.UpdateTooltip = function(self)
							local missingPlayers = { };
							if LootReserve.Server.CurrentSession then
								for player, member in pairs(LootReserve.Server.CurrentSession.Members) do
									if #member.ReservedItems == 0 then
										table.insert(missingPlayers, player);
									end
								end
							end
							GameTooltip:SetOwner(self, "ANCHOR_RIGHT");
							GameTooltip:SetText(#missingPlayers == 0 and "|cFF00FF00All players reserved items|r" or format("%d |4player:players; without reserves:", #missingPlayers));
							for _, player in ipairs(missingPlayers) do
								GameTooltip:AddLine(LootReserve:ColoredPlayer(player));
							end
							GameTooltip:AddLine("Click for more options", GRAY_FONT_COLOR.r, GRAY_FONT_COLOR.g, GRAY_FONT_COLOR.b);
							GameTooltip:Show();
						end
					</OnLoad>
					<OnClick>
						local menuWhisperPlayers = { };
						if LootReserve.Server.CurrentSession then
							for player, member in pairs(LootReserve.Server.CurrentSession.Members) do
								if #member.ReservedItems == 0 then
									table.insert(menuWhisperPlayers,
									{
										text = LootReserve:ColoredPlayer(player),
										arg1 = player,
										func = function(info) ChatFrame_SendTell(info.arg1); end,
									});
								end
							end
						end
						local menu =
						{
							{ text = "Players Without Reserves", isTitle = true },
							{ text = "Whisper All", disabled = #menuWhisperPlayers == 0, func = function() LootReserve.Server:WhisperAllWithoutReserves(); end },
							{ text = "Whisper...", keepShownOnClick = true, hasArrow = true, menuList = menuWhisperPlayers, disabled = #menuWhisperPlayers == 0 },
							{ text = "", isTitle = true },
							{ text = "Cancel" },
						};
						for _, menu in ipairs({ menu, menuWhisperPlayers }) do
							for _, item in ipairs(menu) do
								item.notCheckable = true;
							end
						end
						
						EasyMenu(menu, self:GetParent().Menu, self, 0, 0, "MENU");
					</OnClick>
					<OnMouseDown>
						local x, y = self:GetPushedTextOffset();
						self.Icon:SetPoint("LEFT", self, "LEFT", 6 + x, y);
						self.Arrow:SetPoint("RIGHT", self, "RIGHT", -8 + x, y);
					</OnMouseDown>
					<OnMouseUp>
						self.Icon:SetPoint("LEFT", self, "LEFT", 6, 0);
						self.Arrow:SetPoint("RIGHT", self, "RIGHT", -8, 0);
					</OnMouseUp>
					<OnEnter>
						self:UpdateTooltip();
					</OnEnter>
					<OnLeave function="GameTooltip_Hide" />
				</Scripts>
			</Button>
			<Frame name="LootReserveServerMenu" parentKey="Menu" inherits="UIDropDownMenuTemplate" hidden="true" />
			<Button parentKey="TabSession" inherits="LootReserveServerWindowTabTemplate" id="1" text="Raid Setup">
				<Anchors>
					<Anchor point="BOTTOMLEFT" x="11" y="-31" />
				</Anchors>
			</Button>
			<Button parentKey="TabReserves" inherits="LootReserveServerWindowTabTemplate" id="2" text="Loot Reserves">
				<Anchors>
					<Anchor point="LEFT" relativeKey="$parent.TabSession" relativePoint="RIGHT" x="-15" />
				</Anchors>
			</Button>
			<Frame parentKey="PanelSession" parentArray="Panels">
				<Anchors>
					<Anchor point="TOPLEFT" x="7" y="-27" />
					<Anchor point="BOTTOMRIGHT" x="-9" y="6" />
				</Anchors>
				<Layers>
					<Layer>
						<FontString parentKey="LabelTitle" inherits="GameFontNormalHuge3" text="Loot Reserve">
							<Size y="20" />
							<Anchors>
								<Anchor point="TOP" y="-20" />
							</Anchors>
							<Color r="1" g="1" b="1" />
						</FontString>
						<FontString parentKey="LabelRaidSetup" inherits="GameFontNormalLarge" text="Raid Setup">
							<Size y="20" />
							<Anchors>
								<Anchor point="TOP" relativeKey="$parent.LabelTitle" relativePoint="BOTTOM" />
							</Anchors>
						</FontString>
						<FontString parentKey="LabelRaid" inherits="GameFontNormal" text="Select Raid">
							<Size y="20" />
							<Anchors>
								<Anchor point="TOP" relativeKey="$parent.LabelRaidSetup" relativePoint="BOTTOM" y="-20" />
							</Anchors>
						</FontString>
						<FontString parentKey="LabelCount" inherits="GameFontNormal" text="Max Reserves per Player">
							<Size y="20" />
							<Anchors>
								<Anchor point="TOP" relativeKey="$parent.LabelRaid" relativePoint="BOTTOM" y="-42" />
							</Anchors>
						</FontString>
						<FontString parentKey="LabelDuration" inherits="GameFontNormal" text="Select Duration">
							<Size y="20" />
							<Anchors>
								<Anchor point="TOP" relativeKey="$parent.LabelCount" relativePoint="BOTTOM" y="-30" />
							</Anchors>
						</FontString>
					</Layer>
				</Layers>
				<Frames>
					<Frame name="LootReserveServerDropDownRaid" parentKey="DropDownRaid" inherits="UIDropDownMenuTemplate">
						<Size x="160" y="32" />
						<Anchors>
							<Anchor point="TOP" relativeKey="$parent.LabelRaid" relativePoint="BOTTOM" />
						</Anchors>
						<Scripts>
							<OnLoad>
								UIDropDownMenu_SetWidth(self, self:GetWidth());
								UIDropDownMenu_JustifyText(self, "LEFT");
								UIDropDownMenu_Initialize(self, function(frame, level, menuList)
									local info = UIDropDownMenu_CreateInfo();
									info.minWidth = self:GetWidth() - 40;
									info.func = function(info)
										LootReserve.Server.NewSessionSettings.LootCategory = info.value;
										UIDropDownMenu_SetSelectedValue(self, info.value);
									end
									for id, category in LootReserve:Ordered(LootReserve.Data.Categories) do
										if id > 0 then
											info.text = category.Name;
											info.value = id;
											info.checked = LootReserve.Server.NewSessionSettings.LootCategory == id;
											UIDropDownMenu_AddButton(info);
										end
									end
								end);
							</OnLoad>
						</Scripts>
					</Frame>
					<EditBox name="LootReserveServerDropDownCount" parentKey="EditBoxCount" inherits="InputBoxTemplate" autoFocus="false">
						<Size x="40" y="20" />
						<Anchors>
							<Anchor point="TOP" relativeKey="$parent.LabelCount" relativePoint="BOTTOM" />
						</Anchors>
						<Scripts>
							<OnLoad>
								self:SetJustifyH("CENTER");
								self.Left:SetPoint("LEFT", self, "LEFT", 0, 0);
							</OnLoad>
							<OnTextChanged>
								local count = tonumber(self:GetText());
								if count and count > 0 then
									LootReserve.Server.NewSessionSettings.MaxReservesPerPlayer = count;
								else
									self:SetText("");
								end
							</OnTextChanged>
							<OnEnterPressed>
								self:ClearFocus();
							</OnEnterPressed>
						</Scripts>
					</EditBox>
					<Frame name="LootReserveServerDropDownDuration" parentKey="DropDownDuration" inherits="UIDropDownMenuTemplate">
						<Size x="80" y="32" />
						<Anchors>
							<Anchor point="TOP" relativeKey="$parent.LabelDuration" relativePoint="BOTTOM" />
						</Anchors>
						<Scripts>
							<OnLoad>
								UIDropDownMenu_SetWidth(self, self:GetWidth());
								UIDropDownMenu_JustifyText(self, "LEFT");
								UIDropDownMenu_Initialize(self, function(frame, level, menuList)
									local info = UIDropDownMenu_CreateInfo();
									info.minWidth = self:GetWidth() - 40;
									info.func = function(info)
										LootReserve.Server.NewSessionSettings.Duration = info.value;
										UIDropDownMenu_SetSelectedValue(self, info.value);
									end
									local times = { 0, 10, 30, 60, 90, 120, 180, 240, 300, 600, 900, 1200, 1800, 2700, 3600 };
									for _, time in ipairs(times) do
										info.text = time == 0 and "Manual" or format("%d:%02d", math.floor(time / 60), time % 60);
										info.value = time;
										UIDropDownMenu_AddButton(info);
										info.checked = false;
									end
								end);
							</OnLoad>
						</Scripts>
					</Frame>
					<Button parentKey="ButtonResetSession" inherits="UIPanelButtonTemplate" text="Reset" hidden="true">
						<Size x="75" y="23" />
						<Anchors>
							<Anchor point="BOTTOM" y="10" />
						</Anchors>
						<Scripts>
							<OnClick>
								LootReserve.Server:ResetSession();
							</OnClick>
						</Scripts>
					</Button>
					<Button parentKey="ButtonStartSession" inherits="UIPanelButtonTemplate" text="Start Accepting Reserves">
						<Size x="180" y="23" />
						<Anchors>
							<Anchor point="BOTTOM" relativeKey="$parent.ButtonResetSession" relativePoint="TOP" y="5" />
						</Anchors>
						<Scripts>
							<OnClick>
								if not LootReserve.Server.CurrentSession then
									LootReserve.Server:StartSession();
								elseif not LootReserve.Server.CurrentSession.AcceptingReserves then
									LootReserve.Server:ResumeSession();
								end
							</OnClick>
						</Scripts>
					</Button>
					<Button parentKey="ButtonStopSession" inherits="UIPanelButtonTemplate" text="Stop Accepting Reserves" hidden="true">
						<Anchors>
							<Anchor point="TOPLEFT" relativeKey="$parent.ButtonStartSession" x="1" />
							<Anchor point="BOTTOMRIGHT" relativeKey="$parent.ButtonStartSession" x="-1" />
						</Anchors>
						<Scripts>
							<OnClick>
								LootReserve.Server:StopSession();
							</OnClick>
						</Scripts>
					</Button>
					<StatusBar parentKey="Duration" inherits="LootReserveDurationStatusBar" hidden="true">
						<KeyValues>
							<KeyValue key="server" value="true" type="boolean" />
						</KeyValues>
						<Size x="200" y="8" />
						<Anchors>
							<Anchor point="BOTTOM" relativeKey="$parent.ButtonStartSession" relativePoint="TOP" y="10" />
						</Anchors>
					</StatusBar>
					<Frame parentKey="AddonUsers" hidden="true" enableMouse="true">
						<Size x="30" y="12" />
						<Anchors>
							<Anchor point="BOTTOMRIGHT" x="-2" y="2" />
						</Anchors>
						<Layers>
							<Layer>
								<FontString parentKey="Text" inherits="GameFontNormalGraySmall">
									<Anchors>
										<Anchor point="RIGHT" />
									</Anchors>
									<Color r="0.5" g="0.5" b="0.5" />
								</FontString>
							</Layer>
						</Layers>
						<Scripts>
							<OnLoad>
								self.UpdateTooltip = function(self)
									GameTooltip:SetOwner(self, "ANCHOR_RIGHT");
									GameTooltip:SetText("AddOn Users");
									for _, compatibility in ipairs({ true, false }) do
										for player, compatible in LootReserve:Ordered(LootReserve.Server.AddonUsers) do
											if compatible == compatibility then
												GameTooltip:AddLine(format("%s%s", LootReserve:ColoredPlayer(player), compatible and "" or "|cFFFF0000 (outdated)|r"));
											end
										end
									end
									GameTooltip:Show();
								end
							</OnLoad>
							<OnEnter>
								self:UpdateTooltip();
							</OnEnter>
							<OnLeave function="GameTooltip_Hide" />
						</Scripts>
					</Frame>
				</Frames>
			</Frame>
			<Frame parentKey="NoAuthority" hidden="true" enableMouse="true" frameLevel="1000">
				<Anchors>
					<Anchor point="TOPLEFT" relativeKey="$parent.PanelSession" />
					<Anchor point="BOTTOMRIGHT" relativeKey="$parent.PanelSession" />
				</Anchors>
				<!--Backdrop bgFile="Interface\DialogFrame\UI-DialogBox-Background-Dark" /-->
				<Layers>
					<Layer>
						<FontString inherits="GameFontNormal" text="You must be the raid leader|nor the master looter" />
					</Layer>
				</Layers>
			</Frame>
			<Frame parentKey="PanelReserves" parentArray="Panels" hidden="true">
				<Anchors>
					<Anchor point="TOPLEFT" x="7" y="-48" />
					<Anchor point="BOTTOMRIGHT" x="-9" y="6" />
				</Anchors>
				<Frames>
					<ScrollFrame parentKey="Scroll" inherits="UIPanelScrollFrameTemplate">
						<Anchors>
							<Anchor point="TOPLEFT" x="1" y="-1" />
							<Anchor point="BOTTOMRIGHT" x="-23" y="1" />
						</Anchors>
						<Frames>
							<Frame parentKey="Container" />
						</Frames>
						<Scripts>
							<OnLoad>
								self:SetScrollChild(self.Container);
							</OnLoad>
							<OnShow>
								if InCombatLockdown() then return; end
								self.Container:SetSize(self:GetWidth(), math.max(self.Container.ContentHeight or 0, self:GetHeight()));
							</OnShow>
							<OnSizeChanged>
								if InCombatLockdown() then return; end
								self.Container:SetSize(self:GetWidth(), math.max(self.Container.ContentHeight or 0, self:GetHeight()));
							</OnSizeChanged>
						</Scripts>
					</ScrollFrame>
				</Frames>
			</Frame>
			<Frame parentKey="PanelReservesLockdown" hidden="true">
				<Anchors>
					<Anchor point="TOPLEFT" relativeKey="$parent.Search" relativePoint="BOTTOMLEFT" x="-3" y="-3" />
					<Anchor point="BOTTOMRIGHT" x="-9" y="6" />
				</Anchors>
				<Frames>
					<ScrollFrame parentKey="Scroll" inherits="LootReserveScrollTemplate">
						<Anchors>
							<Anchor point="TOPLEFT" x="1" y="-1" />
							<Anchor point="BOTTOMRIGHT" x="-23" y="1" />
						</Anchors>
					</ScrollFrame>
				</Frames>
			</Frame>
		</Frames>
		<Scripts>
			<OnLoad>
				LootReserve.Server:OnWindowLoad(self);
			</OnLoad>
			<OnShow>
				PlaySound(SOUNDKIT.IG_CHARACTER_INFO_OPEN);
			</OnShow>
			<OnHide>
				PlaySound(SOUNDKIT.IG_CHARACTER_INFO_CLOSE);
				DEFAULT_CHAT_FRAME:AddMessage("Loot Reserve Server window can be reopened by typing |cFFFFD200/reserve server|r", 1, 1, 1);
			</OnHide>
		</Scripts>
	</Frame>
</Ui>